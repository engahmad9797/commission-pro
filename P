async function buyProduct(productId, platform) {
  const clickRes = await fetch('/api/track-click', {
    method:'POST',
    headers:{'Content-Type':'application/json'},
    body: JSON.stringify({ productId, platform })
  });
  const { clickId } = await clickRes.json();

  const linkRes = await fetch('/api/generate-affiliate-link', {
    method:'POST',
    headers:{'Content-Type':'application/json'},
    body: JSON.stringify({ productId, platform, clickId })
  });
  const { affiliateUrl } = await linkRes.json();

  if (affiliateUrl) {
    window.open(affiliateUrl, '_blank');
  } else {
    alert("فشل توليد الرابط");
  }
}
