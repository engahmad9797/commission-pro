<!doctype html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="utf-8">
  <title>ðŸ“Š ØªØ­Ù„ÙŠÙ„Ø§Øª Ø§Ù„Ù…Ø§Ù„Ùƒ</title>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <style>
    body { font-family: Tahoma, sans-serif; padding:20px; background:#f9f9f9; }
    h1 { text-align:center; margin-bottom:30px; }
    .cards { display:flex; gap:20px; justify-content:center; margin-bottom:30px; flex-wrap:wrap; }
    .card { background:#fff; padding:20px; border-radius:10px; box-shadow:0 3px 10px rgba(0,0,0,.1); flex:1; min-width:200px; text-align:center; }
    canvas { background:#fff; border-radius:8px; box-shadow:0 3px 10px rgba(0,0,0,.05); margin-bottom:30px; }
  </style>
</head>
<body>
  <h1>ðŸ“Š Ù„ÙˆØ­Ø© ØªØ­Ù„ÙŠÙ„Ø§Øª Ø§Ù„Ù…Ø§Ù„Ùƒ</h1>

  <div class="cards">
    <div class="card"><h3>Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ù†Ù‚Ø±Ø§Øª</h3><div id="statClicks">0</div></div>
    <div class="card"><h3>Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ù…Ø¨ÙŠØ¹Ø§Øª</h3><div id="statSales">0</div></div>
    <div class="card"><h3>Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ø£Ø±Ø¨Ø§Ø­</h3><div id="statRevenue">$0</div></div>
  </div>

  <canvas id="platformChart" height="120"></canvas>
  <canvas id="productChart" height="120"></canvas>

<script>
async function loadAnalytics() {
  const res = await fetch('/api/owner/analytics', { credentials:'include' });
  const data = await res.json();

  document.getElementById('statClicks').textContent = data.totalClicks;
  document.getElementById('statSales').textContent = data.totalSales;
  document.getElementById('statRevenue').textContent = '$' + (data.totalRevenue || 0).toFixed(2);

  // Ø±Ø³Ù… Ø§Ù„Ù…Ù†ØµØ§Øª
  const platforms = data.topPlatforms.map(p => p.platform);
  const platformRev = data.topPlatforms.map(p => p.rev);

  new Chart(document.getElementById('platformChart'), {
    type:'bar',
    data:{ labels:platforms, datasets:[{ label:'Ø£Ø±Ø¨Ø§Ø­ Ø§Ù„Ù…Ù†ØµØ§Øª ($)', data:platformRev, backgroundColor:'#4CAF50' }] },
    options:{ responsive:true, plugins:{ legend:{ display:false } } }
  });

  // Ø±Ø³Ù… Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª
  const products = data.topProducts.map(p => p.productId);
  const productRev = data.topProducts.map(p => p.rev);

  new Chart(document.getElementById('productChart'), {
    type:'pie',
    data:{ labels:products, datasets:[{ label:'Ø£Ø±Ø¨Ø§Ø­ Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª', data:productRev, backgroundColor:['#FF6384','#36A2EB','#FFCE56','#66BB6A','#FFA726'] }] },
    options:{ responsive:true }
  });
}

loadAnalytics();
</script>
</body>
</html>
